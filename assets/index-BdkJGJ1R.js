import{c as w,I as x,e as g,u as h,a as m,H as v,R as S,j as e,J as C,K as L,M as P,N as T,Q as F,L as k,B as y,r as l,T as d,U as z}from"./index-BcR0Qb-V.js";import{I as $}from"./schemas-BWUwtsDD.js";import{H as q}from"./heart-D9zvnFcJ.js";import{P as K,u as A,r as I,g as Q,i as E,a as B,b as D,T as M,c as _,F as U,C as H,B as O,d as R}from"./index-goORD0My.js";import{u as V}from"./useThemeStore-Cz-gunSI.js";import{a as G,L as J}from"./loading-4tG9n9wT.js";import{P as W}from"./post-DyxCNtlZ.js";import{s as Y}from"./sidebar-f-M9iu5I.js";import"./loader-DVeOD6V0.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Z=w("eye",X),ee="https://linaform-server.onrender.com",f=()=>{const{id:t}=x();return g({queryKey:["post"],queryFn:async()=>{const s=await fetch(ee+"/api/post/"+t);if(!s.ok)throw new Error("Failed to fetch post");return await s.json()}})},j="https://linaform-server.onrender.com",te=()=>{const t=v(),{accessToken:s}=m(),{id:r}=x();return h({mutationKey:["postComment",r],mutationFn:async n=>await fetch(j+`/api/post/${r}/comment`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({content:n})}).then(async i=>{if(!i.ok)throw new Error((await i.json()).error||"Failed to post comment");return!0}),onSuccess:async()=>await t.invalidateQueries({queryKey:["post"]}).then(()=>!0).catch(n=>(console.log(n),!1))})},se=()=>{const{id:t}=x();return h({mutationKey:["postView",t],mutationFn:async()=>await fetch(j+`/api/post/${t}/view`,{method:"POST"}).then(async s=>{s.ok||console.log(s.status)})})},ne=()=>{const{id:t}=x(),{accessToken:s}=m();return h({mutationKey:["postLike",t],mutationFn:async()=>await fetch(j+`/api/post/${t}/like`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}}).then(async r=>{if(!r.ok)throw new Error("Failed to like");return r.json()})})},re=()=>{const{accessToken:t}=m();return h({mutationKey:["postUnlike"],mutationFn:async s=>await fetch(j+`/api/post/${s}/unlike`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then(async r=>{r.ok||console.log(r.status)})})};function ie({open:t,onOpenChange:s}){return e.jsx(C,{open:t,onOpenChange:s,children:e.jsxs(L,{className:"sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsx(P,{children:e.jsx(T,{className:"text-lg font-semibold text-center text-zinc-900 dark:text-zinc-100",children:"Sign in required"})}),e.jsx("p",{className:"text-center text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"You need to sign in to like, subscribe, or post a comment."}),e.jsx("img",{src:"/auth-dialog.svg",alt:"Sign in required",className:"mx-auto w-1/2"}),e.jsxs(F,{children:[e.jsx(k,{to:"/login",className:"w-full",children:e.jsx(y,{variant:"default",className:"w-full",children:"Sign In"})}),e.jsx(k,{to:"/register",className:"w-full",children:e.jsx(y,{variant:"outline",className:"w-full",children:"Register"})})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(y,{variant:"ghost",className:"text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-300",onClick:()=>s(!1),children:"Continue Without Account"})})]})})}const N=S.memo(ie);function ae({likes:t,postId:s}){const{user:r}=m(),[n,i]=l.useState(!1),c=ne(),a=re(),p=t.find(o=>o.userId===r?.id),b=async()=>{if(!r){i(!0);return}if(p)d.setQueryData(["post"],o=>o.likes?{...o,likes:o.likes.filter(u=>u.id!==p.id)}:o),a.mutate(p.id,{onSuccess:()=>{d.invalidateQueries({queryKey:["postUnlike"]})},onError:()=>{d.invalidateQueries({queryKey:["postUnlike"]})}});else{const o={id:"temp-id",userId:r.id,noteId:s};c.mutate(void 0,{onSuccess:()=>{d.invalidateQueries({queryKey:["postLike"]}),d.setQueryData(["post"],u=>u.likes?{...u,likes:[...u.likes,o]}:u)},onError:()=>{d.invalidateQueries({queryKey:["postLike"]})}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"mt-4 flex items-center gap-1 text-sm text-zinc-600 dark:text-zinc-300",onClick:b,children:[e.jsx(q,{className:`${p&&"fill-red-600"} text-red-600`,size:20}),t.length]}),e.jsx(N,{open:n,onOpenChange:i})]})}function oe(){const{data:t}=f(),{setSelectedUserId:s}=z(),r=se();return l.useEffect(()=>{const n=setTimeout(()=>{r.mutate()},1e4);return()=>clearTimeout(n)},[]),t?e.jsx("header",{className:"max-w-3xl mx-auto py-6 border-b border-zinc-200 dark:border-zinc-700 flex justify-between items-start",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-zinc-900 dark:text-zinc-100",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-zinc-600 dark:text-zinc-400 text-sm",children:[e.jsx("button",{onClick:()=>s(t.user.id),className:"font-medium cursor-pointer",children:t.user.username}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(t.publishedAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]}),t.description&&e.jsx("p",{className:"mt-4 text-zinc-700 dark:text-zinc-300 w-full line-clamp-3",children:t.description}),e.jsxs("div",{className:"flex items-center w-full justify-end gap-4",children:[e.jsxs("span",{className:"mt-4 flex items-center gap-1 text-sm text-zinc-600 dark:text-zinc-300",children:[e.jsx(Z,{size:20})," ",t.views]}),e.jsx(ae,{likes:t.likes,postId:t.id})]})]})}):null}var ce=K;function le(){const{data:t,error:s,isLoading:r}=f(),{syncFonts:n}=A(),{theme:i}=V();l.useEffect(()=>{t&&n(t.content)},[n,t]);const c=l.useMemo(()=>{if(!(!t||!t.content))return I(t.content,i=="dark")},[t,i]);if(t&&c){const a=Q(c,[E,B,ce.configure({placeholder:"Start typing..."}),D.configure({types:["heading","paragraph"]}),M,_,U,H,O,R]);return e.jsx(G,{isLoading:r,children:e.jsx("main",{className:"prose prose-gray dark:prose-invert max-w-3xl mx-auto py-6 px-4 sm:px-0",dangerouslySetInnerHTML:{__html:a}})})}else return s?e.jsx("div",{children:s.message}):null}const ue="https://linaform-server.onrender.com";function de(){const{id:t}=x();return g({queryKey:["similar-posts",t],queryFn:async()=>(await fetch(ue+`/api/post/${t}/similar`)).json(),enabled:!!t})}function me(){const{data:t}=f(),{data:s,isLoading:r}=de();return t?e.jsxs("footer",{className:"max-w-3xl mx-auto py-8 border-t border-zinc-200 dark:border-zinc-700 mt-8",children:[e.jsxs("h1",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100",children:["Read more from ",t.user.username]}),e.jsx("h2",{className:"text-zinc-500 dark:text-zinc-400 text-sm",children:"Similar articles"}),r&&e.jsx("div",{className:"mt-2 text-sm text-zinc-500",children:"Loading..."}),s&&s.length>0&&e.jsx("ul",{className:"mt-6 flex flex-col gap-6",children:s.map(n=>e.jsx(W,{post:n},n.id))})]}):null}function xe(){const t=l.useRef(null),{isAuthenticated:s}=m(),[r,n]=l.useState(!1),i=te(),c=()=>{if(!t.current)return;const a=t.current.value.trim();if(a){if(t.current.value="",!s){n(!0);return}i.mutate(a)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx($,{ref:t,placeholder:"Write a comment...",className:"flex-1",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),c())}}),e.jsx(J,{disabled:i.isPending,onClick:c,children:"Post"})]}),e.jsx(N,{open:r,onOpenChange:n})]})}function pe(){const{data:t}=f(),{setSelectedUserId:s}=z(),r=l.useCallback(n=>new Date(n).toLocaleString(void 0,{hour:"numeric",minute:"numeric",day:"numeric",month:"short"}),[]);return!t||!t.comments?null:e.jsxs("section",{className:"max-w-3xl mx-auto py-8 border-t border-zinc-200 dark:border-zinc-700 mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Comments"}),e.jsx("div",{className:"space-y-4",children:t.comments.map(n=>e.jsxs("div",{className:"p-4 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-zinc-50 dark:bg-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("button",{onClick:()=>s(n.user.id),className:"font-medium text-zinc-900 dark:text-zinc-100",children:n.user.username}),e.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:r(n.createdAt)})]}),e.jsx("p",{className:"text-zinc-700 dark:text-zinc-300",children:n.content})]},n.id))}),e.jsx(xe,{})]})}function we(){const{isAuthenticated:t}=m();return e.jsxs("div",{className:"min-h-screen",children:[t&&e.jsx(Y,{className:"fixed"}),e.jsx(oe,{}),e.jsx(le,{}),e.jsx(me,{}),e.jsx(pe,{})]})}export{we as default};
