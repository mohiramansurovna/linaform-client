import{c as y,j as e,d as C,e as D,u as v,r as x,R as k,J as M,K as P,M as T,N as f,ab as g,Q as S,B as h}from"./index-BhFsQ8vH.js";import{u as N,A as E,m as b}from"./index-Cj13C4az.js";import{f as w,b as L,d as R}from"./useNoteMutations-BYC9caU4.js";import{I as F}from"./schemas-CsxVtVro.js";import{C as I,a as V,b as q,c as A,d as z}from"./command-C5BfEKjk.js";import{L as j}from"./loading-BQvoYGo_.js";import{C as O}from"./chevrons-right-CqjWwfCS.js";import"./index-Cs46FEHX.js";import"./normalize-colors-BktJTmvQ.js";import"./sidebar-DNV3oG8l.js";import"./check-check-b_GSMpKm.js";import"./loader-circle-Dfg2y9fz.js";import"./useThemeStore-BDunibeQ.js";import"./search-CT4sTqr8.js";import"./loader-DH6kdCvx.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],_=y("circle-minus",Q);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]],H=y("file-pen",B);function J({className:s,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:C("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}const K=()=>D({queryKey:["tags"],queryFn:async()=>await(await fetch("/api/tags")).json()}),U=()=>v({mutationFn:async s=>await(await fetch("/api/tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:s})})).json(),onSuccess:s=>s.tag,onError:s=>{console.error("failed to create",s)}}),$=()=>v({mutationFn:async s=>{await fetch(`/api/tags/${s}`,{method:"DELETE"})}});function G({selectedTags:s,setSelectedTags:t}){const{data:a,isLoading:l}=K(),c=U(),[r,o]=x.useState(""),p=$(),d=async i=>{console.log(s);const u=a?.find(n=>n.label.toLowerCase()===i.toLowerCase());if(u)t(n=>n.some(m=>m.id===u.id)?n:[...n,u]);else{const{tag:n}=await c.mutateAsync(i);t(m=>[...m,n])}};return e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsxs(I,{children:[e.jsx(V,{placeholder:"Search tags or create new...",value:r,onValueChange:o,onKeyDown:i=>{i.key==="Enter"&&r.trim()&&(i.preventDefault(),d(r.trim()),o(""))}}),e.jsx(q,{children:e.jsxs(A,{children:[l&&e.jsx("p",{children:"Loading tags..."}),r!=""&&a?.map(i=>e.jsx(z,{onSelect:()=>{d(i.label),o("")},children:i.label},i.id))]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(i=>e.jsxs("div",{className:"bg-zinc-200 dark:bg-zinc-900  rounded-md flex items-center gap-1",children:[e.jsx("span",{className:"px-2 py-1 text-sm",children:i.label}),e.jsx("button",{className:" h-full p-2 text-xs",onClick:()=>{p.mutate(i.id),t(u=>u.filter(n=>n.id!==i.id))},children:"âœ•"})]},i.id))})]})}function W({open:s,onOpenChange:t}){const[a,l]=x.useState(),c=w(),{selectedNoteId:r}=L(),o=x.useRef(null),p=x.useRef(null),{data:d}=N(),[i,u]=x.useState(d?.tags||[]);return d&&e.jsx(M,{open:s,onOpenChange:t,children:e.jsxs(P,{className:"overflow-y-scroll scrollbar-custom max-h-screen",children:[e.jsx(T,{children:e.jsx(f,{children:"Post details"})}),a&&e.jsx("p",{className:"text-red-500",children:a}),e.jsx(f,{children:"Title"}),e.jsx(F,{defaultValue:d.title,type:"text",ref:o}),e.jsx(g,{children:"Other users will be able to find your post with title"}),e.jsx(f,{children:"Description"}),e.jsx(J,{defaultValue:d.description??"",ref:p,className:"scrollbar-custom"}),e.jsx(g,{children:"Write brief description about your overall post"}),e.jsx(G,{selectedTags:i,setSelectedTags:u}),e.jsxs(S,{children:[e.jsx(h,{variant:"secondary",onClick:()=>t(!1),children:"Cancel"}),e.jsx(h,{onClick:()=>{if(l(void 0),o.current&&p.current&&r){const n=o.current.value.trim(),m=p.current.value.trim();if(n.length==0){o.current.focus(),l("Title is required");return}if(m.length===0){p.current.focus(),l("Description is required");return}c.mutate({id:r,title:n,description:m,tags:i}),t(!1)}},children:"Update"})]})]})})}const X=k.memo(W);function me({editor:s}){const{data:t}=N(),a=w(),[l,c]=x.useState(!1),r=R();return t&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(H,{})," Edit"]}),e.jsxs(h,{variant:"outline",onClick:()=>r.mutate(t.id),children:[e.jsx(_,{})," Delete"]}),e.jsx(E,{mode:"wait",children:t.isPublished?e.jsxs(b.div,{className:"flex gap-2 h-full *:h-full",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.25},children:[e.jsx(j,{title:"This note is already published. Click to unpublish",variant:"outline",disabled:a.isPending,className:a.isPending?"cursor-not-allowed":"",onClick:()=>{a.mutate({id:t.id,title:t.title,content:t.content,isPublished:!1})},children:"Unpublish"}),e.jsx("a",{href:"/post/"+t.id,children:e.jsxs(h,{className:"h-full",disabled:!a.isSuccess,variant:"ghost",children:["View Post ",e.jsx(O,{className:"inline size-5"})]})})]},"published"):e.jsx(b.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.25},children:e.jsx(j,{className:"h-full",disabled:a.isPending,title:"After publishing, the note and its future updates will be visible to the public.",onClick:()=>{if(t.title=="New note"||t.description==""||!t.tags){c(!0);return}a.mutate({id:t.id,title:t.title,content:s?.getJSON()??t.content,isPublished:!0,publishedAt:new Date(Date.now())})},children:"Publish"})},"unpublished")}),e.jsx(X,{open:l,onOpenChange:c})]})}export{me as default};
