import{j as e,r as h,R as D,L as k}from"./index-DluB5dCl.js";import{c as y,a as M,B as x}from"./createLucideIcon-0o6u6YEZ.js";import{u as v}from"./index-BoyfNiqY.js";import{f as w,b as P,d as T,A as L}from"./index-LMDZ4JDy.js";import{D as S,a as E,b as R,c as f,d as g,e as F}from"./dialog-CUU9GurP.js";import{I}from"./schemas-DY3pto_e.js";import{C as V,a as q,b as A,c as z,d as O}from"./command-BF7lyB6a.js";import{u as _}from"./sidebar-Chdp4x4K.js";import{u as N}from"./useMutation-BezK9uMc.js";import{L as b}from"./loading-D-BgD5Rj.js";import{m as j}from"./proxy-BtzyRkJ0.js";import{C as $}from"./chevrons-right-A25g8XOk.js";import"./index-BEeqayWG.js";import"./useAuthStore-fUHCbePb.js";import"./react-BTsYd7cd.js";import"./check-check-C8wSDcBb.js";import"./loader-circle-fnBM1XxQ.js";import"./index-Dp86KSMC.js";import"./index-BLF7ElBw.js";import"./useThemeStore-DjIK0vOl.js";import"./search-C1jLN-wh.js";import"./useBaseQuery-HNIRHYnW.js";import"./loader-B2PTu4nb.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],H=y("circle-minus",B);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]],U=y("file-pen",Q);function J({className:s,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:M("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}const K="https://linaform-server.onrender.com",G=()=>_({queryKey:["tags"],queryFn:async()=>await(await fetch(K+"/api/tags")).json()}),C="https://linaform-server.onrender.com",W=()=>N({mutationFn:async s=>await(await fetch(C+"/api/tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:s})})).json(),onSuccess:s=>s.tag,onError:s=>{console.error("failed to create",s)}}),X=()=>N({mutationFn:async s=>{await fetch(C+`/api/tags/${s}`,{method:"DELETE"})}});function Y({selectedTags:s,setSelectedTags:t}){const{data:a,isLoading:l}=G(),c=W(),[r,o]=h.useState(""),m=X(),d=async i=>{console.log(s);const u=a?.find(n=>n.label.toLowerCase()===i.toLowerCase());if(u)t(n=>n.some(p=>p.id===u.id)?n:[...n,u]);else{const{tag:n}=await c.mutateAsync(i);t(p=>[...p,n])}};return e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsxs(V,{children:[e.jsx(q,{placeholder:"Search tags or create new...",value:r,onValueChange:o,onKeyDown:i=>{i.key==="Enter"&&r.trim()&&(i.preventDefault(),d(r.trim()),o(""))}}),e.jsx(A,{children:e.jsxs(z,{children:[l&&e.jsx("p",{children:"Loading tags..."}),r!=""&&a?.map(i=>e.jsx(O,{onSelect:()=>{d(i.label),o("")},children:i.label},i.id))]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(i=>e.jsxs("div",{className:"bg-zinc-200 dark:bg-zinc-900  rounded-md flex items-center gap-1",children:[e.jsx("span",{className:"px-2 py-1 text-sm",children:i.label}),e.jsx("button",{className:" h-full p-2 text-xs",onClick:()=>{m.mutate(i.id),t(u=>u.filter(n=>n.id!==i.id))},children:"âœ•"})]},i.id))})]})}function Z({open:s,onOpenChange:t}){const[a,l]=h.useState(),c=w(),{selectedNoteId:r}=P(),o=h.useRef(null),m=h.useRef(null),{data:d}=v(),[i,u]=h.useState(d?.tags||[]);return d&&e.jsx(S,{open:s,onOpenChange:t,children:e.jsxs(E,{className:"overflow-y-scroll scrollbar-custom max-h-screen",children:[e.jsx(R,{children:e.jsx(f,{children:"Post details"})}),a&&e.jsx("p",{className:"text-red-500",children:a}),e.jsx(f,{children:"Title"}),e.jsx(I,{defaultValue:d.title,type:"text",ref:o}),e.jsx(g,{children:"Other users will be able to find your post with title"}),e.jsx(f,{children:"Description"}),e.jsx(J,{defaultValue:d.description??"",ref:m,className:"scrollbar-custom"}),e.jsx(g,{children:"Write brief description about your overall post"}),e.jsx(Y,{selectedTags:i,setSelectedTags:u}),e.jsxs(F,{children:[e.jsx(x,{variant:"secondary",onClick:()=>t(!1),children:"Cancel"}),e.jsx(x,{onClick:()=>{if(l(void 0),o.current&&m.current&&r){const n=o.current.value.trim(),p=m.current.value.trim();if(n.length==0){o.current.focus(),l("Title is required");return}if(p.length===0){m.current.focus(),l("Description is required");return}c.mutate({id:r,title:n,description:p,tags:i}),t(!1)}},children:"Update"})]})]})})}const ee=D.memo(Z);function Ce({editor:s}){const{data:t}=v(),a=w(),[l,c]=h.useState(!1),r=T();return t&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(U,{})," Edit"]}),e.jsxs(x,{variant:"outline",onClick:()=>r.mutate(t.id),children:[e.jsx(H,{})," Delete"]}),e.jsx(L,{mode:"wait",children:t.isPublished?e.jsxs(j.div,{className:"flex gap-2 h-full *:h-full",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.25},children:[e.jsx(b,{title:"This note is already published. Click to unpublish",variant:"outline",disabled:a.isPending,className:a.isPending?"cursor-not-allowed":"",onClick:()=>{a.mutate({id:t.id,title:t.title,content:t.content,isPublished:!1})},children:"Unpublish"}),e.jsx(k,{to:"/post/"+t.id,children:e.jsxs(x,{className:"h-full",disabled:!a.isSuccess,variant:"ghost",children:["View Post ",e.jsx($,{className:"inline size-5"})]})})]},"published"):e.jsx(j.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.25},children:e.jsx(b,{className:"h-full",disabled:a.isPending,title:"After publishing, the note and its future updates will be visible to the public.",onClick:()=>{if(t.title=="New note"||t.description==""||!t.tags){c(!0);return}a.mutate({id:t.id,title:t.title,content:s?.getJSON()??t.content,isPublished:!0,publishedAt:new Date(Date.now())})},children:"Publish"})},"unpublished")}),e.jsx(ee,{open:l,onOpenChange:c})]})}export{Ce as default};
