import{c as b,I as x,e as k,u as p,a as m,H as w,R as v,j as e,J as S,K as C,M as L,N as P,Q as T,L as y,B as j,r as l,T as d,U as g}from"./index-BhFsQ8vH.js";import{I as F}from"./schemas-CsxVtVro.js";import{H as $}from"./heart-CWHS2Fp0.js";import{P as q,u as K,r as A,g as I,i as Q,a as E,b as B,T as D,c as M,F as _,C as U,B as H,d as O}from"./normalize-colors-BktJTmvQ.js";import{u as R}from"./useThemeStore-BDunibeQ.js";import{a as V,L as G}from"./loading-BQvoYGo_.js";import{P as J}from"./post-BqeRNgKP.js";import{s as W}from"./sidebar-DNV3oG8l.js";import"./loader-DH6kdCvx.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],X=b("eye",Y),f=()=>{const{id:t}=x();return k({queryKey:["post"],queryFn:async()=>{const s=await fetch("/api/post/"+t);if(!s.ok)throw new Error("Failed to fetch post");return await s.json()}})},Z=()=>{const t=w(),{accessToken:s}=m(),{id:r}=x();return p({mutationKey:["postComment",r],mutationFn:async n=>await fetch(`/api/post/${r}/comment`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({content:n})}).then(async i=>{if(!i.ok)throw new Error((await i.json()).error||"Failed to post comment");return!0}),onSuccess:async()=>await t.invalidateQueries({queryKey:["post"]}).then(()=>!0).catch(n=>(console.log(n),!1))})},ee=()=>{const{id:t}=x();return p({mutationKey:["postView",t],mutationFn:async()=>await fetch(`/api/post/${t}/view`,{method:"POST"}).then(async s=>{s.ok||console.log(s.status)})})},te=()=>{const{id:t}=x(),{accessToken:s}=m();return p({mutationKey:["postLike",t],mutationFn:async()=>await fetch(`/api/post/${t}/like`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}}).then(async r=>{if(!r.ok)throw new Error("Failed to like");return r.json()})})},se=()=>{const{accessToken:t}=m();return p({mutationKey:["postUnlike"],mutationFn:async s=>await fetch(`/api/post/${s}/unlike`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then(async r=>{r.ok||console.log(r.status)})})};function ne({open:t,onOpenChange:s}){return e.jsx(S,{open:t,onOpenChange:s,children:e.jsxs(C,{className:"sm:max-w-md bg-white dark:bg-zinc-900",children:[e.jsx(L,{children:e.jsx(P,{className:"text-lg font-semibold text-center text-zinc-900 dark:text-zinc-100",children:"Sign in required"})}),e.jsx("p",{className:"text-center text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"You need to sign in to like, subscribe, or post a comment."}),e.jsx("img",{src:"/auth-dialog.svg",alt:"Sign in required",className:"mx-auto w-1/2"}),e.jsxs(T,{children:[e.jsx(y,{to:"/login",className:"w-full",children:e.jsx(j,{variant:"default",className:"w-full",children:"Sign In"})}),e.jsx(y,{to:"/register",className:"w-full",children:e.jsx(j,{variant:"outline",className:"w-full",children:"Register"})})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(j,{variant:"ghost",className:"text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-300",onClick:()=>s(!1),children:"Continue Without Account"})})]})})}const z=v.memo(ne);function re({likes:t,postId:s}){const{user:r}=m(),[n,i]=l.useState(!1),c=te(),a=se(),h=t.find(o=>o.userId===r?.id),N=async()=>{if(!r){i(!0);return}if(h)d.setQueryData(["post"],o=>o.likes?{...o,likes:o.likes.filter(u=>u.id!==h.id)}:o),a.mutate(h.id,{onSuccess:()=>{d.invalidateQueries({queryKey:["postUnlike"]})},onError:()=>{d.invalidateQueries({queryKey:["postUnlike"]})}});else{const o={id:"temp-id",userId:r.id,noteId:s};c.mutate(void 0,{onSuccess:()=>{d.invalidateQueries({queryKey:["postLike"]}),d.setQueryData(["post"],u=>u.likes?{...u,likes:[...u.likes,o]}:u)},onError:()=>{d.invalidateQueries({queryKey:["postLike"]})}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"mt-4 flex items-center gap-1 text-sm text-zinc-600 dark:text-zinc-300",onClick:N,children:[e.jsx($,{className:`${h&&"fill-red-600"} text-red-600`,size:20}),t.length]}),e.jsx(z,{open:n,onOpenChange:i})]})}function ie(){const{data:t}=f(),{setSelectedUserId:s}=g(),r=ee();return l.useEffect(()=>{const n=setTimeout(()=>{r.mutate()},1e4);return()=>clearTimeout(n)},[]),t?e.jsx("header",{className:"max-w-3xl mx-auto py-6 border-b border-zinc-200 dark:border-zinc-700 flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-zinc-900 dark:text-zinc-100",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-zinc-600 dark:text-zinc-400 text-sm",children:[e.jsx("button",{onClick:()=>s(t.user.id),className:"font-medium",children:t.user.username}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(t.publishedAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]}),t.description&&e.jsx("p",{className:"mt-4 text-zinc-700 dark:text-zinc-300",children:t.description}),e.jsxs("div",{className:"flex items-center w-full justify-end gap-4",children:[e.jsxs("span",{className:"mt-4 flex items-center gap-1 text-sm text-zinc-600 dark:text-zinc-300",children:[e.jsx(X,{size:20})," ",t.views]}),e.jsx(re,{likes:t.likes,postId:t.id})]})]})}):null}var ae=q;function oe(){const{data:t,error:s,isLoading:r}=f(),{syncFonts:n}=K(),{theme:i}=R();l.useEffect(()=>{t&&n(t.content)},[n,t]);const c=l.useMemo(()=>{if(!(!t||!t.content))return A(t.content,i=="dark")},[t,i]);if(t&&c){const a=I(c,[Q,E,ae.configure({placeholder:"Start typing..."}),B.configure({types:["heading","paragraph"]}),D,M,_,U,H,O]);return e.jsx(V,{isLoading:r,children:e.jsx("main",{className:"prose prose-gray dark:prose-invert max-w-3xl mx-auto py-6 px-4 sm:px-0",dangerouslySetInnerHTML:{__html:a}})})}else return s?e.jsx("div",{children:s.message}):null}function ce(){const{id:t}=x();return k({queryKey:["similar-posts",t],queryFn:async()=>(await fetch(`/api/post/${t}/similar`)).json(),enabled:!!t})}function le(){const{data:t}=f(),{data:s,isLoading:r}=ce();return t?e.jsxs("footer",{className:"max-w-3xl mx-auto py-8 border-t border-zinc-200 dark:border-zinc-700 mt-8",children:[e.jsxs("h1",{className:"text-lg font-semibold text-zinc-900 dark:text-zinc-100",children:["Read more from ",t.user.username]}),e.jsx("h2",{className:"text-zinc-500 dark:text-zinc-400 text-sm",children:"Similar articles"}),r&&e.jsx("div",{className:"mt-2 text-sm text-zinc-500",children:"Loading..."}),s&&s.length>0&&e.jsx("ul",{className:"mt-6 flex flex-col gap-6",children:s.map(n=>e.jsx(J,{post:n},n.id))})]}):null}function ue(){const t=l.useRef(null),{isAuthenticated:s}=m(),[r,n]=l.useState(!1),i=Z(),c=()=>{if(!t.current)return;const a=t.current.value.trim();if(a){if(t.current.value="",!s){n(!0);return}i.mutate(a)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(F,{ref:t,placeholder:"Write a comment...",className:"flex-1",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),c())}}),e.jsx(G,{disabled:i.isPending,onClick:c,children:"Post"})]}),e.jsx(z,{open:r,onOpenChange:n})]})}function de(){const{data:t}=f(),{setSelectedUserId:s}=g(),r=l.useCallback(n=>new Date(n).toLocaleString(void 0,{hour:"numeric",minute:"numeric",day:"numeric",month:"short"}),[]);return!t||!t.comments?null:e.jsxs("section",{className:"max-w-3xl mx-auto py-8 border-t border-zinc-200 dark:border-zinc-700 mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-zinc-900 dark:text-zinc-100",children:"Comments"}),e.jsx("div",{className:"space-y-4",children:t.comments.map(n=>e.jsxs("div",{className:"p-4 border border-zinc-200 dark:border-zinc-700 rounded-lg bg-zinc-50 dark:bg-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("button",{onClick:()=>s(n.user.id),className:"font-medium text-zinc-900 dark:text-zinc-100",children:n.user.username}),e.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:r(n.createdAt)})]}),e.jsx("p",{className:"text-zinc-700 dark:text-zinc-300",children:n.content})]},n.id))}),e.jsx(ue,{})]})}function ze(){const{isAuthenticated:t}=m();return e.jsxs("div",{className:"min-h-screen",children:[t&&e.jsx(W,{className:"fixed"}),e.jsx(ie,{}),e.jsx(oe,{}),e.jsx(le,{}),e.jsx(de,{})]})}export{ze as default};
